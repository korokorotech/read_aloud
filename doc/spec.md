# アプリ仕様書（画面一覧・画面遷移準拠）

## 前提
- ログイン不要
- 完全ローカル完結（通信はWebViewでの閲覧のみ）
- データ保存は端末内（SQLite）
- 主目的：
  **Webで見つけた記事を、1操作でキューに追加し、連続音声再生できること**

---

# 1. 全体構成

## アプリの役割
- ニュースを「探す」アプリではない
- ニュースを「聴くためにローカルに集め、長時間聞くことができる」アプリ
- WebViewは補助的UI、主役は **キュー管理と音声再生**

---

# 2. 画面一覧と仕様

## 1. ホーム（ニュースセット一覧）

### 目的
- 保存されているニュースセット（再生キューの集合）を管理する

### 表示要素
- ニュースセット一覧
  - セット名
  - 記事件数
  - 最終更新日時
- 「＋ 新規作成」ボタン

### 操作
- セットをタップ
  → **2. ニュースセット詳細**
- 「＋ 新規作成」
  → **2. ニュースセット詳細（新規）**

---

## 2. ニュースセット詳細（キュー管理）

### 目的
- 1つのニュースセット内の記事キューを管理・再生する

### 表示要素
- セット名（編集可能）
- 記事キュー一覧
  - タイトル
  - 出典ドメイン
  - 追加日時
- 「再生」ボタン
- 「記事を追加」ボタン

### 操作
- 「再生」
  → **3. プレイヤー**
- 「記事を追加」
  → **4. WebView（記事追加）**
- 記事をスワイプ削除（任意）
- 戻る
  → **1. ホーム**

---

## 3. プレイヤー（連続読み上げ）

### 目的
- ニュースセット内の記事を順番に音声読み上げする

### 表示要素
- 再生中の記事情報
  - タイトル
  - 出典
  - 進捗（例：3 / 12）
- 再生操作
  - 再生 / 一時停止
  - 次へ / 前へ
- （任意）再生速度調整
- （任意）「元記事を開く」

### 挙動
- 記事単位で連続再生
- 再生終了後、自動で次の記事へ

### 操作
- 「元記事を開く」
  → **4. WebView（閲覧専用・追加モードOFF）**
- 戻る
  → **2. ニュースセット詳細**

---

## 4. WebView（記事追加）

### 目的
- Web検索・閲覧を行い、記事をキューに追加する

### 表示要素
- WebView
- 右上トグル「追加モード ON / OFF」（デフォルト：OFF）
- （任意）戻る / 進む / リロード

### 挙動
#### 追加モード OFF
- 通常のWebブラウズ
- リンクタップ → 通常遷移

#### 追加モード ON（最重要仕様）
- リンクタップ時：
  - ページ遷移をキャンセル
  - タップしたリンクURLを即座にキューに追加
  - 確認ダイアログは出さない
- 追加後：
  - 画面下にSnackBar表示
    - 文言：「キューに追加しました」
    - Action：「もとに戻す」
      - 押下時：直前に追加した記事を削除
- WebViewの表示は変わらない（その場に留まる）

### 技術要件
- `flutter_inappwebview`
- `shouldOverrideUrlLoading` でリンク遷移をフック
- 追加モードON時のみキャンセル＆保存
- URL正規化を行う
  - `utm_*` などのトラッキング削除
  - 可能なら Google `/url?q=` の実URL解決
- 正規化後URLで重複チェック

### 操作
- 戻る
  → **2. ニュースセット詳細**

---

## 5. 記事プレビュー（任意・将来）

### 目的
- キュー内の記事内容を事前確認する

### 表示要素（任意）
- タイトル / 出典 / 追加日時
- 整形済みテキスト or 要約
- 「元記事を開く」

### 操作
- 「元記事を開く」
  → **4. WebView**
- 戻る
  → **2. ニュースセット詳細**

---

## 6. 設定（任意・将来）

### 目的
- 再生・動作設定を変更する

### 想定項目
- 読み上げ速度
- 音声選択
- 追加モードのデフォルトON/OFF
- URL正規化のON/OFF
- 全データ削除
- プライバシーポリシー表示

# 3. 画面遷移まとめ

ホーム
└─ ニュースセット詳細
├─ プレイヤー
│   └─ WebView（閲覧）
└─ WebView（記事追加）

# 4. 非機能要件

## データ
- SQLiteで永続化
- 端末外への送信なし

## UX
- 記事追加は必ず **1操作**
- 失敗時はUndoで即復旧
- 操作中にモーダル確認は出さない

## 審査配慮
- 自動収集・スクレイピング表現を使わない
- 「ユーザーが選択したWebページを音声で再生するアプリ」として説明可能な構成

---

# 5. MVP（最初に実装する範囲）
- 画面 1〜4
- 追加モードON/OFF
- キュー追加 + Undo
- 連続読み上げ（最低限）
